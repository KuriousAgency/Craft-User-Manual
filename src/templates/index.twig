
{% extends "_layouts/cp" %}

{% do view.registerAssetBundle("kuriousagency\\usermanual\\assetbundles\\usermanual\\UserManualAsset") %}

{% set sectionSelected = (craft.userManual.settings.section is defined)
  ? craft.userManual.settings.section
  : "Homepage" %}

{% set title = craft.userManual.name|t %}
{% set sidebar %}
{% set extraNav = getExternalNav()|raw %}

{# {% if extraNav == false %}{% redirect '/admin/settings/plugins/usermanual' %}{% endif %} #}
{% set masterLoop = 1 %}
{% set active = false %}
  <nav>
    {% if sectionSelected == null %}
      {% set help = null %}
    {% else %}
      {% set help = craft.entries.sectionId(sectionSelected).all() %}
    {% endif %}
    <ul>
    {% for remote in extraNav if remote.level == 1 %}
      {% set active = 'remote/'~remote.slug == craft.app.request.segments[-2:]|join("/") or craft.app.request.segments|last == 'usermanual'%}
        <li>
          <a {% if active %}class="sel"{% endif %} href="{{ url('usermanual/remote/' ~ remote.slug) }}">{{ remote.title }}</a>
          {% if remote.hasDescendants %}
            <ul>
              {% for child in remote.children %}
                {% set active = 'remote/'~child.slug == craft.app.request.segments[-2:]|join("/") %}
                <li>
                  <a {% if active %}class="sel"{% endif %} href="{{ url('usermanual/remote/' ~ child.slug) }}">{{ child.title }}</a>
                </li>
              {% endfor %}
            </ul>
          {% endif %}
        </li>
      {% endfor %}
      {% nav page in help %}
        {% set active = page.uri == craft.app.request.segments[-2:]|join("/") %}
        <li>
          <a {% if active %}class="sel"{% endif %}
            href="{{ url('usermanual/' ~ page.uri) }}">
            {{page.title}}
          </a>
          {% ifchildren %}
              <ul>
                  {% children %}
              </ul>
          {% endifchildren %}
          </li>
      {% endnav %}  
    </ul>
  </nav>
{% endset %}

{% set content %}
  <div id="user-manual">
  {% if  (craft.app.request.getSegment(2) == 'remote') or (craft.app.request.segments|last == 'usermanual') %}
    {{ getExternalDocument(sectionSelected)|raw }}
  {% else %}
    {{ getHelpDocument(sectionSelected)|raw }}
  {% endif %}
  </div>
{% endset %}
